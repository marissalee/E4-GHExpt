---
title: "E4 manuscript Results - Using ggplot"
author: "Marissa Lee"
date: "September 26, 2014"
output:
  pdf_document: default
  html_document: default
---
*Filename: e4_ms_results.Rmd'*

*A. This code needs the following files:*  

1. In the folder 'e4DataPackage_092614'
  + 'e4_potData.txt'
  + 'e4_potData_dictionary.txt'
2. In the folder 'e4CodePackage_100614'
  + 'e4_cleanCode.R'
  + 'e4_calcsiCode.R'
  + 'mytheme.R'
  + 'e4_Fig2stats.R' and 'e4_makeFig2.R' --> both reference --> 'e4_prepdfFig2.R'
  + 'e4_Fig3stats.R' and 'e4_makeFig3.R' --> both reference --> 'e4_prepdfFig3.R'
  + 'e4_Fig4stats.R' and 'e4_makeFig4.R' --> both reference --> 'e4_prepdfFig4.R'

*B. This code does the following things:*  

1. Clean raw dataset (run external code)
2. Make plots and the stats that support them
    + Fig2. Species' biomass
    + Fig3. Soil measures under monocultures and M.v. density alone
    + Fig4. Soil measures under mixture pots plotted against M.v. biomass and total biomass


*******************

#1. Clean raw dataset (run external code)
```{r,echo=TRUE}
source('e4CodePackage_100614/e4_cleanCode.R')
#str(data)

### Read-in all the custom functions for doing stats ###
source('e4CodePackage_100614/statFxns.R')
```

*******************

#2. Plot  




###Fig2 : Plant biomasses vs density trt
```{r, echo=TRUE, warning=FALSE, message=FALSE, fig.width = 4, fig.height = 7}
source('e4CodePackage_100614/e4_Fig2stats.R')
source('e4CodePackage_100614/e4_makeFig2.R')

#plot
fig2

#means
PrettyMeans.2levs(sum.fig2a)
PrettyMeans.2levs(sum.fig2b.mivi)
PrettyMeans.2levs(sum.fig2b.comp)
PrettyMeans.2levs(sum.fig2c)


#lme4
# y ~ mvtrt + comptrt + mvtrt:comptrt + (1|bk)
PrettyLME4(lme.fig2a)
PrettyLME4(lme.fig2b.mivi)
PrettyLME4(lme.fig2b.comp)
PrettyLME4(lme.fig2c)


#lm
# lm.fig2a
# lm.fig2b.mivi
# lm.fig2b.comp
# lm.fig2c

```


```{r,echo=FALSE, include=FALSE}
####Fig2a letters ... not adding this...
tuks <- PullTuks(lm.fig2a$tukys$'mvtrt:comptrt')

#within P
wP<-grep('..P...P', tuks$nam)
tuks[wP,] # all mvtrt levels are different except 1 to 2

#within S
wS<-grep('..S...S', tuks$nam)
tuks[wS,] # none of the levels are different

#within mvtrt levels
wmvtrt0<-grep('0...0..', tuks$nam)
wmvtrt1<-grep('1...1..', tuks$nam)
wmvtrt2<-grep('2...2..', tuks$nam)
wmvtrt4<-grep('4...4..', tuks$nam)
wmvtrt5<-grep('5...5..', tuks$nam)
tuks[wmvtrt0,] # not diff
tuks[wmvtrt1,] # diff (0.01)
tuks[wmvtrt2,] # diff (<0.01)
tuks[wmvtrt4,] # diff (<0.01)
tuks[wmvtrt5,] # diff (<0.01)

```




###Fig3 : Monocultures vs total biomass and soil measurements
```{r, echo=TRUE, warning=FALSE, message=FALSE, fig.height=7, fig.width=3.5}
source('e4CodePackage_100614/e4_Fig3stats.R')
source('e4CodePackage_100614/e4_makeFig3.R')

#plot
fig3

#means
sum.fig3a #total biomass
PrettyMeans.2levs(sum.fig3b) #soil measures


#lme4
# y ~ type + (1|bk)
lme.fig3a[[2]]$anova.pval #total biomass
PrettyLME.fig3b(lme.fig3b) #soil measures

```

####Fig3a letters 
```{r,echo=FALSE}
tuks <- PullTuks(lm.fig3a$tukys)
tuks # all are different (p <0.01) except Pavi v Mivi

```

####Fig3b letters 
```{r,echo=FALSE}
#nhdi
PullTuks(lm.fig3b$tukys$nhdi) 
# Only Sobi v Empty are different (p<0.01)

#nodi
PullTuks(lm.fig3b$tukys$nodi) 
# All different (p<0.01) except...
# Pavi v Mivi
# Sobi v Pavi

#toti
PullTuks(lm.fig3b$tukys$totdi)
# All different (p<0.01) except...
# Pavi v Mivi
# Sobi v Pavi

#ammonifd
PullTuks(lm.fig3b$tukys$ammonifd)
# None are different

#nitrifd
PullTuks(lm.fig3b$tukys$nitrifd)
# None are different

#minzd
PullTuks(lm.fig3b$tukys$minzd)
# None are different

#soilmoi
PullTuks(lm.fig3b$tukys$soilmoi)
# Sobi v Empty (p<0.01)
# Sobi v Mivi (p<0.01)
# Sobi v Pavi (p<0.01)

```




##Fig4 : Mivi biomass vs soil measures w/o neighbors
```{r,echo=TRUE, warning=FALSE, message=FALSE, fig.height=7, fig.width=4}
source('e4CodePackage_100614/e4_Fig4stats.R')
source('e4CodePackage_100614/e4_makeFig4.R')

#plot
fig4


#lme4 anova pvals
PrettyLME.fig4(lme.fig4)


```



##Fig5. Mixture plant biomass vs soil measures
+ Calculate the change in soil measurement values in the presence of M.v. (run external code)
```{r,echo=TRUE}
source('e4CodePackage_100614/e4_calcsiCode.R')
#str(datas)
```

+ Fig 5
```{r,echo=TRUE, warning=FALSE, message=FALSE,  fig.height=7, fig.width=6}
source('e4CodePackage_100614/e4_Fig5stats.R')
source('e4CodePackage_100614/e4_makeFig5.R')

#plot
fig5

#for mivi
PrettyMeans.2levs(sum.fig5.mivi) #comptrt means
PrettyLME.fig5(lme.fig5.mivi) #pvals and fixed effect coefs

#for total
PrettyMeans.2levs(sum.fig5.total) #comptrt means
PrettyLME.fig5(lme.fig5.total) #pvals and fixed effect coefs


```



*******************

#3. Other stats????

### Predict soil measurement using mivi biomass, compabund, and total
+ Set up model fxns (run external code.... make these into mixed effects models)  
```{r, echo=TRUE, include=FALSE}
#str(datas)
datas2<-datas
source('e4CodePackage_100614/e4_fitmodCode.R')
#ModFxn1
#ModFxn2
#ModFxn3
```
+ Set up generic fxn to pull out info from each fitted model 
+ Fit the models  
+ Organize fitted model results into tables; view the fitted model results
+ Significant model terms

Model 1. sF = (mivi * beta)  
```{r,echo=FALSE, include=FALSE}
#dim(modl1)
PvalSumm(modl1, 0.1)
```
  
Model 2. sF = (mivi * beta) + (compabund * beta2) + ((mivi * compabund) * beta3)  
```{r,echo=FALSE, include=FALSE}
#dim(modl2)
PvalSumm(modl2, 0.1)
```
  
Model 3. sF = (total * beta)  
```{r,echo=FALSE, include=FALSE}
#dim(modl3)
PvalSumm(modl3, 0.1)
```








